<!DOCTYPE html>
<html>
<head>
    <title>fry</title>
    <script type="text/javascript" src="worker.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
    <!--<script src="jsQR.js"></script>-->
</head>
<body>
    <h1>Scan your QR code</h1>
    <video id="preview" autoplay></video>
    <canvas id="canvas" style="display: none"></canvas>
    <script type="module">

        const constraints = {
            video: true
        };

        const video = document.querySelector('#preview');
        const canvas = document.querySelector("#canvas");

        let canvasContext = null;

        const onCameraStart = (stream) => {
            video.srcObject = stream;
            canvasContext = canvas.getContext("2d");
        };

        navigator.mediaDevices
            .getUserMedia(constraints)
            .then(onCameraStart);

        // import jsQR from './jsQR';
        let worker = new Worker("worker.js");

        worker.addEventListener("message", function (msg) {
            console.log(msg.data)
        });

        // console.log(streamHeight, streamWidth);

        const captureFrame = () => {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            canvasContext.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
            return canvasContext.getImageData(0, 0, video.videoWidth, video.videoHeight);
        };

        setInterval(onAnimation, 200);

        function onAnimation() {
            if (!canvasContext) {
                return;
            }
            const { data } = captureFrame();

            onFrame({
                data: data,
                width: video.videoWidth,
                height: video.videoHeight,
            });
        }
        const onFrame = (frameData) => worker.postMessage(frameData);

    </script>
    <p>Order:
        <ul>
            <li>list element, </li>
            <li>list element, </li>
            <li>list element</li>
        </ul>
    </p>
</body>
</html>